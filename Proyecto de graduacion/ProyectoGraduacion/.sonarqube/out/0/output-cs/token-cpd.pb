€|
SF:\Proyecto de graduacion\ProyectoGraduacion\CapaControladorProyecto\Controlador.cs
	namespace

 	#
CapaControladorProyecto


 !
{ 
public 

class 
Controlador 
{ 
private 

Sentencias 
sn 
= 
new  #

Sentencias$ .
(. /
)/ 0
;0 1
public 
byte 
[ 
] 
obtenerByte !
(! "
string" (
id) +
)+ ,
{ 	
byte 
[ 
] 
imagen 
= 
sn 
. 
obtenerByte *
(* +
id+ -
)- .
;. /
return 
imagen 
; 
} 	
public 
void 
insertaNuevaFoto $
($ %
string% +
id, .
,. /
byte0 4
[4 5
]5 6
foto7 ;
); <
{ 	
sn 
. 
insertaNuevaFoto 
(  
id  "
," #
foto$ (
)( )
;) *
} 	
public 
void 
insertaFoto 
(  
string  &
id' )
,) *
byte+ /
[/ 0
]0 1
foto2 6
)6 7
{ 	
sn 
. 
insertaFoto 
( 
id 
, 
foto #
)# $
;$ %
} 	
public 
int %
idSiguienteDeNuevoIngreso ,
(, -
string- 3
tabla4 9
,9 :
string; A
campoBB H
)H I
{ 	
int 
id 
= 
sn 
. %
idSiguienteDeNuevoIngreso 1
(1 2
tabla2 7
,7 8
campoB9 ?
)? @
;@ A
return   
id   
;   
}!! 	
public%% 
	DataTable%% (
llanarTblEmpleadoDisponibles%% 5
(%%5 6
string%%6 <
dato%%= A
)%%A B
{&& 	
	DataTable'' 
table'' 
='' 
new'' !
	DataTable''" +
(''+ ,
)'', -
;''- .
table(( 
=(( 
sn(( 
.(( (
llanarTblEmpleadoDisponibles(( 3
(((3 4
dato((4 8
)((8 9
;((9 :
return)) 
table)) 
;)) 
}** 	
public++ 
	DataTable++ '
llanarTblEmpleadosAsignados++ 4
(++4 5
string++5 ;
tabla++< A
,++A B
string++C I
dato++J N
)++N O
{,, 	
	DataTable-- 
table-- 
=-- 
new-- !
	DataTable--" +
(--+ ,
)--, -
;--- .
table.. 
=.. 
sn.. 
... &
llanarTblEmpleadoAsignados.. 1
(..1 2
tabla..2 7
,..7 8
dato..9 =
)..= >
;..> ?
return// 
table// 
;// 
}00 	
public22 
void22 
AsignarEmpleados22 $
(22$ %
string22% +
tabla22, 1
,221 2
string223 9
valor122: @
,22@ A
string22B H
valor222I O
)22O P
{33 	
sn44 
.44 
AsignarEmpleados44 
(44  
tabla44  %
,44% &
valor144' -
,44- .
valor244/ 5
)445 6
;446 7
}55 	
public66 
void66 %
AsignarATodosLosEmpleados66 -
(66- .
string66. 4
tabla665 :
,66: ;
string66< B
valor66C H
)66H I
{77 	
sn88 
.88 %
AsignarATodosLosEmpleados88 (
(88( )
tabla88) .
,88. /
valor880 5
)885 6
;886 7
}99 	
public:: 
void:: &
EliminarUnEmpleadoAsignado:: .
(::. /
string::/ 5
tabla::6 ;
,::; <
string::= C
valor1::D J
,::J K
string::L R
valor2::S Y
)::Y Z
{;; 	
sn<< 
.<< &
EliminarUnEmpleadoAsignado<< )
(<<) *
tabla<<* /
,<</ 0
valor1<<1 7
,<<7 8
valor2<<9 ?
)<<? @
;<<@ A
}== 	
public?? 
void?? 1
%EliminarTodasLasAsignacionesEmpleados?? 9
(??9 :
string??: @
tabla??A F
,??F G
string??H N
valor??O T
)??T U
{@@ 	
snAA 
.AA 1
%EliminarTodasLasAsignacionesEmpleadosAA 4
(AA4 5
tablaAA5 :
,AA: ;
valorAA< A
)AAA B
;AAB C
}BB 	
publicEE 
voidEE 
bloqueabotonesEE "
(EE" #
stringEE# )
tipousuarioEE* 5
,EE5 6
ButtonEE7 =
btnIngresarEE> I
,EEI J
ButtonEEK Q
	btnEditarEER [
,EE[ \
ButtonEE] c

btnGuardarEEd n
,EEn o
ButtonEEp v
btnCancelar	EEw Ç
,
EEÇ É
Button
EEÑ ä
btnEliminar
EEã ñ
,
EEñ ó
Button
EEò û
btnImprimir
EEü ™
,
EE™ ´
Button
EE¨ ≤
btnActualizar
EE≥ ¿
,
EE¿ ¡
Button
EE¬ »
btnAyuda
EE… —
,
EE— “
Button
EE” Ÿ
btnSalir
EE⁄ ‚
)
EE‚ „
{FF 	
snGG 
.GG 
bloqueabotonesGG 
(GG 
tipousuarioGG )
,GG) *
btnIngresarGG+ 6
,GG6 7
	btnEditarGG8 A
,GGA B

btnGuardarGGC M
,GGM N
btnCancelarGGO Z
,GGZ [
btnEliminarGG\ g
,GGg h
btnImprimirGGi t
,GGt u
btnActualizar	GGv É
,
GGÉ Ñ
btnAyuda
GGÖ ç
,
GGç é
btnSalir
GGè ó
)
GGó ò
;
GGò ô
}HH 	
publicJJ 
voidJJ 
	LlenarCBXJJ 
(JJ 
ComboBoxJJ &
cbxJJ' *
,JJ* +
stringJJ, 2
tablaJJ3 8
,JJ8 9
stringJJ: @
campobuscadoJJA M
)JJM N
{KK 	
tryLL 
{MM 
snNN 
.NN 
	LlenarCBXNN 
(NN 
cbxNN  
,NN  !
tablaNN" '
,NN' (
campobuscadoNN) 5
)NN5 6
;NN6 7
}OO 
catchPP 
{QQ 

MessageBoxRR 
.RR 
ShowRR 
(RR  
$strRR  d
)RRd e
;RRe f
}SS 
}TT 	
publicVV 
	DataTableVV 
ActualizaDetallesVV *
(VV* +
stringVV+ 1
tablaDBVV2 9
,VV9 :
stringVV; A

cotizacionVVB L
)VVL M
{WW 	
returnZZ 
snZZ 
.ZZ 
ActualizaDetallesZZ '
(ZZ' (
tablaDBZZ( /
,ZZ/ 0

cotizacionZZ1 ;
)ZZ; <
;ZZ< =
}[[ 	
public]] 
	DataTable]] 
ActualizarDGV]] &
(]]& '
string]]' -
tablaDB]]. 5
)]]5 6
{^^ 	
returnaa 
snaa 
.aa 
ActualizarDGVaa #
(aa# $
tablaDBaa$ +
)aa+ ,
;aa, -
}bb 	
publicdd 
voiddd 
convertirFechaDTPdd %
(dd% &
DateTimePickerdd& 4
dtpdd5 8
,dd8 9
TextBoxdd: A
txtddB E
)ddE F
{ee 	
snff 
.ff 
convertirFechaDTPff  
(ff  !
dtpff! $
,ff$ %
txtff& )
)ff) *
;ff* +
}gg 	
publicii 
voidii 
convertirFechaMySQLii '
(ii' (
DateTimePickerii( 6
dtpii7 :
,ii: ;
TextBoxii< C
txtiiD G
)iiG H
{jj 	
snkk 
.kk 
convertirFechaMySQLkk "
(kk" #
dtpkk# &
,kk& '
txtkk( +
)kk+ ,
;kk, -
}ll 	
publicnn 
voidnn 
IDCombonn 
(nn 
TextBoxnn #
textboxnn$ +
,nn+ ,
stringnn- 3
tablann4 9
,nn9 :
stringnn; A
campobuscadonnB N
,nnN O
stringnnP V
nombrennW ]
)nn] ^
{oo 	
trypp 
{qq 
snrr 
.rr 
IDcomborr 
(rr 
textboxrr "
,rr" #
tablarr$ )
,rr) *
campobuscadorr+ 7
,rr7 8
nombrerr9 ?
)rr? @
;rr@ A
}ss 
catchtt 
{uu 

MessageBoxvv 
.vv 
Showvv 
(vv  
$strvv  d
)vvd e
;vve f
}ww 
}xx 	
publiczz 
voidzz 
LlenarCBXProductozz %
(zz% &
ComboBoxzz& .
cbxzz/ 2
,zz2 3
stringzz4 :
tablazz; @
,zz@ A
stringzzB H
campobuscadozzI U
,zzU V
stringzzW ]

inventariozz^ h
)zzh i
{{{ 	
try|| 
{}} 
sn~~ 
.~~ 
LlenarCBXProducto~~ $
(~~$ %
cbx~~% (
,~~( )
tabla~~* /
,~~/ 0
campobuscado~~1 =
,~~= >

inventario~~? I
)~~I J
;~~J K
} 
catch
ÄÄ 
{
ÅÅ 

MessageBox
ÇÇ 
.
ÇÇ 
Show
ÇÇ 
(
ÇÇ  
$str
ÇÇ  j
)
ÇÇj k
;
ÇÇk l
}
ÉÉ 
}
ÑÑ 	
public
ÜÜ 
void
ÜÜ 
NombreID
ÜÜ 
(
ÜÜ 
ComboBox
ÜÜ %
combo
ÜÜ& +
,
ÜÜ+ ,
string
ÜÜ- 3
tabla
ÜÜ4 9
,
ÜÜ9 :
string
ÜÜ; A
campobuscado
ÜÜB N
,
ÜÜN O
string
ÜÜP V
nombre
ÜÜW ]
)
ÜÜ] ^
{
áá 	
try
àà 
{
ââ 
sn
ää 
.
ää 
NombreID
ää 
(
ää 
combo
ää !
,
ää! "
tabla
ää# (
,
ää( )
campobuscado
ää* 6
,
ää6 7
nombre
ää8 >
)
ää> ?
;
ää? @
}
ãã 
catch
åå 
{
çç 

MessageBox
éé 
.
éé 
Show
éé 
(
éé  
$str
éé  d
)
ééd e
;
éée f
}
èè 
}
êê 	
public
íí 
void
íí 

IDProducto
íí 
(
íí 
TextBox
íí &
textbox
íí' .
,
íí. /
string
íí0 6
tabla
íí7 <
,
íí< =
string
íí> D
campobuscado
ííE Q
,
ííQ R
string
ííS Y
nombre
ííZ `
,
íí` a
string
ííb h

inventario
ííi s
)
íís t
{
ìì 	
try
îî 
{
ïï 
sn
ññ 
.
ññ 

IDProducto
ññ 
(
ññ 
textbox
ññ %
,
ññ% &
tabla
ññ' ,
,
ññ, -
campobuscado
ññ. :
,
ññ: ;
nombre
ññ< B
,
ññB C

inventario
ññD N
)
ññN O
;
ññO P
}
óó 
catch
òò 
{
ôô 

MessageBox
öö 
.
öö 
Show
öö 
(
öö  
$str
öö  d
)
ööd e
;
ööe f
}
õõ 
}
úú 	
public
ûû 
string
ûû 
	BuscaDato
ûû 
(
ûû  
string
ûû  &
tabla
ûû' ,
,
ûû, -
string
ûû. 4
campo
ûû5 :
,
ûû: ;
string
ûû< B
campobuscado
ûûC O
,
ûûO P
string
ûûQ W
datoreferencia
ûûX f
)
ûûf g
{
üü 	
string
†† 
dato
†† 
=
†† 
$str
†† 
;
†† 
dato
°° 
=
°° 
sn
°° 
.
°° 
	BuscaDato
°° 
(
°°  
tabla
°°  %
,
°°% &
campo
°°' ,
,
°°, -
campobuscado
°°. :
,
°°: ;
datoreferencia
°°< J
)
°°J K
;
°°K L
return
¢¢ 
dato
¢¢ 
;
¢¢ 
}
££ 	
public
•• 
void
•• 
NombreIDProducto
•• $
(
••$ %
ComboBox
••% -
combo
••. 3
,
••3 4
string
••5 ;
tabla
••< A
,
••A B
string
••C I
campobuscado
••J V
,
••V W
string
••X ^
pkid
••_ c
,
••c d
string
••e k

inventario
••l v
)
••v w
{
¶¶ 	
try
ßß 
{
®® 
sn
©© 
.
©© 
NombreIDProducto
©© #
(
©©# $
combo
©©$ )
,
©©) *
tabla
©©+ 0
,
©©0 1
campobuscado
©©2 >
,
©©> ?
pkid
©©@ D
,
©©D E

inventario
©©F P
)
©©P Q
;
©©Q R
}
™™ 
catch
´´ 
{
¨¨ 

MessageBox
≠≠ 
.
≠≠ 
Show
≠≠ 
(
≠≠  
$str
≠≠  d
)
≠≠d e
;
≠≠e f
}
ÆÆ 
}
ØØ 	
public
±± 
void
±± 
metodoInsertar
±± "
(
±±" #
string
±±# )
query
±±* /
)
±±/ 0
{
≤≤ 	
sn
≥≥ 
.
≥≥ 
metodoInsertar
≥≥ 
(
≥≥ 
query
≥≥ #
)
≥≥# $
;
≥≥$ %
}
¥¥ 	
public
∂∂ 
void
∂∂ 
metodoModificar
∂∂ #
(
∂∂# $
string
∂∂$ *
query
∂∂+ 0
)
∂∂0 1
{
∑∑ 	
sn
∏∏ 
.
∏∏ 
metodoModificar
∏∏ 
(
∏∏ 
query
∏∏ $
)
∏∏$ %
;
∏∏% &
}
ππ 	
public
ªª 
void
ªª 
metodoDarBaja
ªª !
(
ªª! "
string
ªª" (
query
ªª) .
)
ªª. /
{
ºº 	
sn
ΩΩ 
.
ΩΩ 
metodoDarBaja
ΩΩ 
(
ΩΩ 
query
ΩΩ "
)
ΩΩ" #
;
ΩΩ# $
}
ææ 	
public
øø 
void
øø 
metodoEliminar
øø "
(
øø" #
string
øø# )
query
øø* /
)
øø/ 0
{
¿¿ 	
sn
¡¡ 
.
¡¡ 
metodoEliminar
¡¡ 
(
¡¡ 
query
¡¡ #
)
¡¡# $
;
¡¡$ %
}
¬¬ 	
public
√√ 
	DataTable
√√ 
ObtenerDetalles
√√ (
(
√√( )
string
√√) /

cotizacion
√√0 :
,
√√: ;
string
√√< B
total
√√C H
)
√√H I
{
ƒƒ 	
return
«« 
sn
«« 
.
«« 
ObtenerDetalles
«« %
(
««% &

cotizacion
««& 0
,
««0 1
total
««2 7
)
««7 8
;
««8 9
}
»» 	
public
ÃÃ 
void
ÃÃ 
bloqueareporte
ÃÃ "
(
ÃÃ" #
string
ÃÃ# )
tipousuario
ÃÃ* 5
,
ÃÃ5 6
Button
ÃÃ7 =
reporte
ÃÃ> E
)
ÃÃE F
{
ÕÕ 	
sn
ŒŒ 
.
ŒŒ 
bloqueareporte
ŒŒ 
(
ŒŒ 
tipousuario
ŒŒ )
,
ŒŒ) *
reporte
ŒŒ+ 2
)
ŒŒ2 3
;
ŒŒ3 4
}
œœ 	
}
–– 
}““ È4
QF:\Proyecto de graduacion\ProyectoGraduacion\CapaControladorProyecto\Encriptar.cs
	namespace		 	#
CapaControladorProyecto		
 !
{

 
public 

class 
	Encriptar 
{ 
public 
string 
metodoEncryptString )
() *
string* 0
key1 4
,4 5
string6 <
	plainText= F
)F G
{ 	
byte 
[ 
] 
iv 
= 
new 
byte  
[  !
$num! #
]# $
;$ %
byte 
[ 
] 
array 
; 
using 
( 
Aes 
aes 
= 
Aes  
.  !
Create! '
(' (
)( )
)) *
{ 
aes 
. 
Key 
= 
Encoding "
." #
UTF8# '
.' (
GetBytes( 0
(0 1
key1 4
)4 5
;5 6
aes 
. 
IV 
= 
iv 
; 
ICryptoTransform  
	encryptor! *
=+ ,
aes- 0
.0 1
CreateEncryptor1 @
(@ A
aesA D
.D E
KeyE H
,H I
aesJ M
.M N
IVN P
)P Q
;Q R
using 
( 
MemoryStream #
memoryStream$ 0
=1 2
new3 6
MemoryStream7 C
(C D
)D E
)E F
{ 
using 
( 
CryptoStream '
cryptoStream( 4
=5 6
new7 :
CryptoStream; G
(G H
(H I
StreamI O
)O P
memoryStreamP \
,\ ]
	encryptor^ g
,g h
CryptoStreamModei y
.y z
Writez 
)	 Ä
)
Ä Å
{ 
using 
( 
StreamWriter +
streamWriter, 8
=9 :
new; >
StreamWriter? K
(K L
(L M
StreamM S
)S T
cryptoStreamT `
)` a
)a b
{ 
streamWriter   (
.  ( )
Write  ) .
(  . /
	plainText  / 8
)  8 9
;  9 :
}!! 
array## 
=## 
memoryStream##  ,
.##, -
ToArray##- 4
(##4 5
)##5 6
;##6 7
}$$ 
}%% 
}&& 
return(( 
Convert(( 
.(( 
ToBase64String(( )
((() *
array((* /
)((/ 0
;((0 1
})) 	
public++ 
string++ 
metodoDecryptString++ )
(++) *
string++* 0
key++1 4
,++4 5
string++6 <

cipherText++= G
)++G H
{,, 	
byte-- 
[-- 
]-- 
iv-- 
=-- 
new-- 
byte--  
[--  !
$num--! #
]--# $
;--$ %
byte.. 
[.. 
].. 
buffer.. 
=.. 
Convert.. #
...# $
FromBase64String..$ 4
(..4 5

cipherText..5 ?
)..? @
;..@ A
using// 
(// 
Aes// 
aes// 
=// 
Aes//  
.//  !
Create//! '
(//' (
)//( )
)//) *
{00 
aes11 
.11 
Key11 
=11 
Encoding11 "
.11" #
UTF811# '
.11' (
GetBytes11( 0
(110 1
key111 4
)114 5
;115 6
aes22 
.22 
IV22 
=22 
iv22 
;22 
ICryptoTransform33  
	decryptor33! *
=33+ ,
aes33- 0
.330 1
CreateDecryptor331 @
(33@ A
aes33A D
.33D E
Key33E H
,33H I
aes33J M
.33M N
IV33N P
)33P Q
;33Q R
using55 
(55 
MemoryStream55 #
memoryStream55$ 0
=551 2
new553 6
MemoryStream557 C
(55C D
buffer55D J
)55J K
)55K L
{66 
using77 
(77 
CryptoStream77 '
cryptoStream77( 4
=775 6
new777 :
CryptoStream77; G
(77G H
(77H I
Stream77I O
)77O P
memoryStream77P \
,77\ ]
	decryptor77^ g
,77g h
CryptoStreamMode77i y
.77y z
Read77z ~
)77~ 
)	77 Ä
{88 
using99 
(99 
StreamReader99 +
streamReader99, 8
=999 :
new99; >
StreamReader99? K
(99K L
(99L M
Stream99M S
)99S T
cryptoStream99T `
)99` a
)99a b
{:: 
return;; "
streamReader;;# /
.;;/ 0
	ReadToEnd;;0 9
(;;9 :
);;: ;
;;;; <
}<< 
}== 
}>> 
}?? 
}AA 	
publicBB 
stringBB &
metodoEncriptarContrase√±aBB /
(BB/ 0
stringBB0 6
datoBB7 ;
)BB; <
{CC 	
tryDD 
{EE 
varFF 
keyFF 
=FF 
$strFF <
;FF< =
stringGG 
hashGG 
=GG 
metodoEncryptStringGG 1
(GG1 2
keyGG2 5
,GG5 6
datoGG7 ;
)GG; <
;GG< =
returnHH 
hashHH 
;HH 
}II 
catchJJ 
(JJ 
	ExceptionJJ 
exJJ 
)JJ  
{KK 
ConsoleLL 
.LL 
	WriteLineLL !
(LL! "
$strLL" @
+LLA B
exLLC E
)LLE F
;LLF G
returnMM 
$strMM 
;MM 
}NN 
}OO 	
publicPP 
stringPP 
metodoValidarPP #
(PP# $
stringPP$ *
datoPP+ /
)PP/ 0
{QQ 	
varRR 
keyRR 
=RR 
$strRR 8
;RR8 9
stringSS 
passwordSS 
=SS 
metodoDecryptStringSS 1
(SS1 2
keySS2 5
,SS5 6
datoSS7 ;
)SS; <
;SS< =
returnTT 
passwordTT 
;TT 
}UU 	
}VV 
}WW ø
NF:\Proyecto de graduacion\ProyectoGraduacion\CapaControladorProyecto\Global.cs
	namespace 	#
CapaControladorProyecto
 !
{		 
public

 
class

 
Global

 
{ 
private 	
	DataTable
 
table 
= 
new 
	DataTable  )
() *
)* +
;+ ,
private 	
string
 
fechat 
; 
private 	
string
 
usuario 
; 
private 	
string
 
id 
; 
private 	
string
 

idtusuario 
; 
private 	
string
 
nombretusuario 
;  
private 	
string
 

cotizacion 
; 
public 
	DataTable	 
obtenertabla 
{ 
get 
{ 
return	 
table 
; 
} 
set 
{ 
table	 
= 
value 
; 
} 
} 
public 
string	 
fechatrabajada 
{ 
get 
{ 
return	 
fechat 
; 
} 
set 
{ 
fechat	 
= 
value 
; 
} 
} 
public   
string  	 
obtieneusuario   
{!! 
get"" 
{"" 
return""	 
usuario"" 
;"" 
}"" 
set## 
{## 
usuario##	 
=## 
value## 
;## 
}## 
}$$ 
public%% 
string%%	 
	obtieneid%% 
{&& 
get'' 
{'' 
return''	 
id'' 
;'' 
}'' 
set(( 
{(( 
id((	 
=(( 
value(( 
;(( 
}(( 
})) 
public** 
string**	 
obtieneidtusuario** !
{++ 
get,, 
{,, 
return,,	 

idtusuario,, 
;,, 
},, 
set-- 
{-- 

idtusuario--	 
=-- 
value-- 
;-- 
}-- 
}.. 
public// 
string//	 !
obtienenombretusuario// %
{00 
get11 
{11 
return11	 
nombretusuario11 
;11 
}11  !
set22 
{22 
nombretusuario22	 
=22 
value22 
;22  
}22! "
}33 
public44 
string44	 "
cotizacionseleccionada44 &
{55 
get66 
{66 
return66	 

cotizacion66 
;66 
}66 
set77 
{77 

cotizacion77	 
=77 
value77 
;77 
}77 
}88 
}99 
}:: ä
_F:\Proyecto de graduacion\ProyectoGraduacion\CapaControladorProyecto\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str 2
)2 3
]3 4
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str 4
)4 5
]5 6
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[## 
assembly## 	
:##	 

AssemblyVersion## 
(## 
$str## $
)##$ %
]##% &
[$$ 
assembly$$ 	
:$$	 

AssemblyFileVersion$$ 
($$ 
$str$$ (
)$$( )
]$$) *